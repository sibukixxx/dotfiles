# CLAUDE.md - Global Project Guidelines

## Testing Philosophy (t-wada Style)

このプロジェクトでは、和田卓人（t-wada）氏のテスト駆動開発の哲学に基づいてテストを行う。

### TDD サイクル (Red → Green → Refactor)

1. **Red**: まず失敗するテストを書く
2. **Green**: テストを通す最小限のコードを書く
3. **Refactor**: コードを整理する（テストは常に Green を維持）

### テストの原則

- **テストファースト**: 実装コードを書く前にテストを書く
- **小さなステップ**: 一度に一つのことだけをテストする
- **テストコードも本番コード**: テストコードの品質も本番コードと同様に重要
- **独立性**: 各テストは他のテストに依存しない
- **再現性**: 何度実行しても同じ結果になる
- **高速**: テストは素早く実行できる

### テスト構造 (Arrange-Act-Assert / Given-When-Then)

```
// Arrange (Given) - 準備
const calculator = new Calculator();

// Act (When) - 実行
const result = calculator.add(1, 2);

// Assert (Then) - 検証
expect(result).toBe(3);
```

### テスト名の命名規則

テスト名は「何をテストしているか」を明確に表現する：
- `it('should return sum of two numbers')`
- `it('throws error when input is negative')`
- `describe('Calculator#add')` でグループ化

### テストダブルの使い方

- **本物を使えるなら本物を使う**
- 外部依存（DB、API、ファイルシステム）のみモック化
- モックは最小限に、振る舞いの検証は慎重に

### テストピラミッド

```
      /\
     /  \     E2E テスト（少）
    /----\
   /      \   統合テスト（中）
  /--------\
 /          \ ユニットテスト（多）
/------------\
```

### 避けるべきアンチパターン

- テストのないコードをコミットしない
- 複数のことを一つのテストで検証しない
- テストの実行順序に依存しない
- 本番コードにテスト用のロジックを入れない
- 実装の詳細をテストしない（振る舞いをテストする）

### リファクタリング時の注意

- リファクタリング中はテストを変更しない
- テストが Green のままであることを常に確認
- 小さなステップで進める

## Code Quality

- コードを書く際は、まずテストを考える
- 「このコードはどうテストするか？」を常に意識する
- テストしにくいコードは設計を見直すサイン
